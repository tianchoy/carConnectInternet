{"version":3,"file":"http.js","sources":["api/http.uts"],"sourcesContent":["// 基础配置\r\nconst BASE_URL = 'https://your-api-domain.com' // https base地址\r\nconst TIMEOUT = 5000 // 请求超时时间（ms）\r\n\r\nconst http = (url, method = 'GET', data = {}, config = {}) => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\t// 请求拦截\r\n\t\tconst finalConfig = requestInterceptor({\r\n\t\t\turl: `${BASE_URL}${url}`,\r\n\t\t\tmethod,\r\n\t\t\tdata,\r\n\t\t\ttimeout: TIMEOUT,\r\n\t\t\theader: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t...config.header\r\n\t\t\t},\r\n\t\t\t...config\r\n\t\t})\r\n\r\n\t\t// 发起请求\r\n\t\tuni.request({\r\n\t\t\t...finalConfig,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tconsole.log(res)\r\n\t\t\t\t// 响应拦截\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst processedData = responseInterceptor(res)\r\n\t\t\t\t\tresolve(processedData)\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\treject(err)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\treject(err.errMsg || '网络错误')\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n}\r\n\r\n\r\n// 请求拦截器\r\nconst requestInterceptor = (config) => {\r\n\t// 添加Token\r\n\tconst token = uni.getStorageSync('token') || ''\r\n\tif (token) {\r\n\t\tconfig.header = config.header || {}\r\n\t\tconfig.header['Authorization'] = `Bearer ${token}`\r\n\t}\r\n\treturn config\r\n}\r\n\r\n// 响应拦截器\r\nconst responseInterceptor = (response, config) => {\r\n\tconst { statusCode, data } = response;\r\n\tconst { url, method } = config;\r\n\r\n\t// HTTP状态码异常\r\n\tif (statusCode < 200 || statusCode >= 300) {\r\n\t\tuni.showToast({\r\n\t\t\ttitle: `请求失败 (HTTP ${statusCode})`,\r\n\t\t\ticon: 'none'\r\n\t\t})\r\n\t\treturn Promise.reject({\r\n\t\t\ttype: 'http',\r\n\t\t\tcode: statusCode,\r\n\t\t\tmessage: `[${method}] ${url} 请求失败 (HTTP ${statusCode})`,\r\n\t\t\toriginal: response\r\n\t\t});\r\n\t}\r\n\r\n\t// 业务自定义错误码\r\n\tif (data?.code !== undefined && data.code !== 200) {\r\n\t\tconst error = {\r\n\t\t\ttype: 'business',\r\n\t\t\tcode: data.code,\r\n\t\t\tmessage: data.message || '业务逻辑错误',\r\n\t\t\toriginal: data\r\n\t\t};\r\n\r\n\t\t// 特殊错误码处理（如Token过期）\r\n\t\tif (data.code === 401) {\r\n\t\t\tuni.reLaunch({ url: '/pages/login' });\r\n\t\t}\r\n\r\n\t\treturn Promise.reject(error);\r\n\t}\r\n\r\n\t// 数据安全校验\r\n\tif (config.needSignature && !validateDataSignature(data)) {\r\n\t\treturn Promise.reject({\r\n\t\t\ttype: 'security',\r\n\t\t\tcode: -300,\r\n\t\t\tmessage: '数据签名验证失败'\r\n\t\t});\r\n\t}\r\n\r\n\t// 成功数据处理\r\n\treturn {\r\n\t\t...data,\r\n\t\t_metadata: {\r\n\t\t\ttimestamp: Date.now(),\r\n\t\t\tapi: url\r\n\t\t}\r\n\t};\r\n};\r\n\r\n\r\nexport default http"],"names":["uni"],"mappings":";;AACA,MAAM,WAAW;AACjB,MAAM,UAAU;AAEhB,MAAM,OAAO,CAAC,MAAG,MAAE,SAAS,OAAO,yBAAO,CAAE,CAAA,GAAE,SAAA,IAAA,cAAS,CAAE,CAAA,MAAA;AACxD,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAM;AAElC,UAAM,cAAc,mBAAkB,IAAA,cAAA,OAAA,OAAA;AAAA,MACrC,KAAK,GAAG,QAAQ,GAAG,GAAG;AAAA,MACtB;AAAA,MACA;AAAA,MACA,SAAS;AAAA,MACT,QACC,IAAA,cAAA,OAAA,OAAA,EAAA,gBAAgB,mBAAkB,GAC/B,OAAO,MAAM,CAEd;AAAA,IAAA,GAAA,MAAM;AAIVA,kBAAAA,MAAI,QACA,OAAA,OAAA,OAAA,OAAA,CAAA,GAAA,WAAW,KACd,SAAS,CAAC,QAAG;AACZA,oBAAAA,MAAA,MAAA,OAAA,sBAAY,GAAG;AAEf,UAAI;AACH,cAAM,gBAAgB,oBAAoB,GAAG;AAC7C,gBAAQ,aAAa;AAAA,MACrB,SAAQ,KAAK;AACb,eAAO,GAAG;AAAA,MACV;AAAA,IACF,GACA,MAAM,CAAC,QAAG;AACT,aAAO,IAAI,UAAU,MAAM;AAAA,IAC3B,EAAA;EAEH,CAAC;AACF;AAIA,MAAM,qBAAqB,CAAC,SAAM,SAAA;AAEjC,QAAM,QAAQA,cAAG,MAAC,eAAe,OAAO,KAAK;AAC7C,MAAI,OAAO;AACV,WAAO,SAAS,OAAO,UAAM,IAAA,cAAI,CAAA,CAAE;AACnC,WAAO,OAAO,eAAe,IAAI,UAAU,KAAK;AAAA,EAChD;AACD,SAAO;AACR;AAGA,MAAM,sBAAsB,CAAC,WAAQ,MAAE,SAAM,SAAA;AACpC,QAAA,aAAqB,SAAQ,YAAjB,OAAS,SAAQ;AAC7B,QAAA,MAAgB,OAAM,KAAjB,SAAW,OAAM;AAG9B,MAAI,aAAa,OAAO,cAAc,KAAK;AAC1CA,kBAAAA,MAAI,UAAU;AAAA,MACb,OAAO,cAAc,UAAU;AAAA,MAC/B,MAAM;AAAA,IACN,CAAA;AACD,WAAO,QAAQ,OAAO,IAAA,cAAA;AAAA,MACrB,MAAM;AAAA,MACN,MAAM;AAAA,MACN,SAAS,IAAI,MAAM,KAAK,GAAG,eAAe,UAAU;AAAA,MACpD,UAAU;AAAA,IACV,CAAA,CAAA;AAAA,EACD;AAGD,OAAI,SAAI,QAAJ,SAAI,SAAA,OAAJ,KAAM,UAAS,UAAa,KAAK,SAAS,KAAK;AAClD,UAAM,QAAQ,IAAA,cAAA;AAAA,MACb,MAAM;AAAA,MACN,MAAM,KAAK;AAAA,MACX,SAAS,KAAK,WAAW;AAAA,MACzB,UAAU;AAAA,IACV,CAAA;AAGD,QAAI,KAAK,SAAS,KAAK;AACtBA,oBAAAA,MAAI,SAAS,EAAE,KAAK,eAAgB,CAAA;AAAA,IACpC;AAED,WAAO,QAAQ,OAAO,KAAK;AAAA,EAC3B;AAGD,MAAI,OAAO,iBAAiB,CAAC,sBAAsB,IAAI,GAAG;AACzD,WAAO,QAAQ,OAAO,IAAA,cAAA;AAAA,MACrB,MAAM;AAAA,MACN,MAAM;AAAA,MACN,SAAS;AAAA,IACT,CAAA,CAAA;AAAA,EACD;AAGD,SACI,IAAA,cAAA,OAAA,OAAA,OAAA,OAAA,CAAA,GAAA,IAAI,GACP,EAAA,WAAW,IAAA,cAAA;AAAA,IACV,WAAW,KAAK,IAAK;AAAA,IACrB,KAAK;AAAA,GACL,EACA,CAAA,CAAA;AACH;;"}