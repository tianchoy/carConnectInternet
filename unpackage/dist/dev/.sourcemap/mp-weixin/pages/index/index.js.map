{"version":3,"file":"index.js","sources":["pages/index/index.uvue","pages/index/index.uvue?type=page"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<custom-navBar title=\"首页\" :show-back=\"false\" backgroundColor=\"#fff\" textColor=\"#333\"\r\n\t\t\t@capsuleClick=\"handleCapsule\" :showCapsule=\"true\">\r\n\t\t</custom-navBar>\r\n\t\t<view class=\"map-container\" v-if=\"showMap\">\r\n\t\t\t<map id=\"myMap\" :latitude=\"center.latitude\" :longitude=\"center.longitude\" :markers=\"markers\"\r\n\t\t\t\t:scale=\"mapScale\" style=\"width:100%;height:100%\" :show-location=\"true\">\r\n\t\t\t</map>\r\n\t\t\t<deviceInfoComponent :show-popup=\"showDevicePopup\" :device-info=\"currentDeviceInfo\"\r\n\t\t\t\t@close=\"closeDevicePopup\" />\r\n\t\t</view>\r\n\t\t<view v-else>\r\n\t\t\t<indexListMode />\r\n\t\t</view>\r\n\t\t<view class=\"tool-nav\">\r\n\t\t\t<view class=\"btn-map-list\" @click=\"toggleMapMode\">\r\n\t\t\t\t<image :src=\"showMap ? '/static/list.png' : '/static/map.png'\" class=\"btn-map-list-icon\" />\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup lang=\"uts\">\r\n\timport amapFile from '../../utils/amap-wx.130'\r\n\r\n\tconst navBarHeight = ref(88); // 由组件实际高度决定\r\n\r\n\tconst handleCapsule = (type) => {\r\n\t\tif (type === 'close') {\r\n\t\t\tuni.navigateBack();\r\n\t\t} else {\r\n\t\t\tuni.showToast({ title: '菜单点击', icon: 'none' });\r\n\t\t}\r\n\t};\r\n\r\n\t// 地图状态\r\n\tconst center = reactive({\r\n\t\tlatitude: 39.90469,\r\n\t\tlongitude: 116.40717\r\n\t})\r\n\tconst mapScale = ref(12)\r\n\tconst showMap = ref(true)\r\n\r\n\t//高德地图相关\r\n\tconst address = ref('')\r\n\tconst gdKey = 'e3e773ad74f7ba25f38775c9c8db6474'\r\n\tconst myAmapFun = ref()\r\n\r\n\t// 标记点集合\r\n\tconst markers = ref<Array<any>>([])\r\n\r\n\t// 控制弹窗显示\r\n\tconst showDevicePopup = ref(false)\r\n\tconst currentDeviceInfo = ref({\r\n\t\tdeviceName: '',\r\n\t\tcarNumber: '',\r\n\t\tdeviceSerial: '',\r\n\t\tlocationType: '',\r\n\t\tlngLat: '',\r\n\t\tupdateTime: '',\r\n\t\tlocationTime: '',\r\n\t\tspeed: '',\r\n\t\ttotalMileage: '',\r\n\t\taddress: ''\r\n\t})\r\n\r\n\r\n\t// 初始化加载测试的电子围栏\r\n\tonMounted(async () => {\r\n\t\tmyAmapFun.value = new amapFile.AMapWX({ key: gdKey });\r\n\t\tawait getlocation() //获取当前位置\t\r\n\r\n\t})\r\n\r\n\t//获取当前位置\r\n\tconst getlocation = () => {\r\n\t\tuni.getLocation({\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tuni.__f__('log','at pages/index/index.uvue:80','当前坐标点：', res);\r\n\t\t\t\tcenter.latitude = res.latitude\r\n\t\t\t\tcenter.longitude = res.longitude\r\n\t\t\t\tgetRegeo(res.latitude, res.longitude)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst getRegeo = (latitude, longitude) => {\r\n\t\tmyAmapFun.value.getRegeo({\r\n\t\t\tlocation: `${longitude},${latitude}`,\r\n\t\t\tsuccess: (data) => {\r\n\t\t\t\tuni.__f__('log','at pages/index/index.uvue:92','获取地址信息:', data)\r\n\t\t\t\tif (data.length > 0) {\r\n\t\t\t\t\taddress.value = data[0].regeocodeData.formatted_address\r\n\t\t\t\t\tuni.__f__('log','at pages/index/index.uvue:95','地址信息:', address.value)\r\n\t\t\t\t\tmarkers.value = [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: 1,\r\n\t\t\t\t\t\t\tlatitude: latitude,\r\n\t\t\t\t\t\t\tlongitude: longitude,\r\n\t\t\t\t\t\t\ticonPath: '/static/marker.png',\r\n\t\t\t\t\t\t\twidth: 40,\r\n\t\t\t\t\t\t\theight: 40,\r\n\t\t\t\t\t\t\tcallout: {\r\n\t\t\t\t\t\t\t\tcontent: address.value,\r\n\t\t\t\t\t\t\t\tborderRadius: 5,\r\n\t\t\t\t\t\t\t\tpadding: 5,\r\n\t\t\t\t\t\t\t\tdisplay: 'ALWAYS'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({ title: '获取地址失败', icon: 'none' })\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: err.errMsg,\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t//打开地图app跳转\r\n\tconst handMarkerTap = (e) => {\r\n\t\t// const mapContext = uni.createMapContext(\"myMap\", this); \r\n\t\t// mapContext.openMapApp({\r\n\t\t// \tlatitude: center.latitude,  \r\n\t\t// \tlongitude: center.longitude, \r\n\t\t// \tdestination: address.value, \r\n\t\t// \tsuccess(res) {\r\n\t\t// \t\tuni.__f__('log','at pages/index/index.uvue:133','success!!', res);\r\n\t\t// \t},\r\n\t\t// \tfail(err) {\r\n\t\t// \t\tuni.showToast({\r\n\t\t// \t\t\ttitle: err.errMsg,\r\n\t\t// \t\t\ticon: 'none'\r\n\t\t// \t\t})\r\n\t\t// \t}\r\n\t\t// });\r\n\t\tuni.__f__('log','at pages/index/index.uvue:142','markertap event:', e)\r\n\r\n\t\t// 微信小程序返回的是markerId\r\n\t\tif (e.detail && e.detail.markerId !== undefined) {\r\n\t\t\tconst markerId = e.detail.markerId\r\n\t\t\tconst marker = markers.value.find(m => m.id === markerId)\r\n\r\n\t\t\tif (marker && marker.extData) {\r\n\t\t\t\tcurrentDeviceInfo.value = {\r\n\t\t\t\t\tdeviceName: marker.extData.deviceName || '',\r\n\t\t\t\t\tcarNumber: marker.extData.carNumber || '',\r\n\t\t\t\t\tdeviceSerial: marker.extData.deviceSerial || '',\r\n\t\t\t\t\tlocationType: marker.extData.locationType || '',\r\n\t\t\t\t\tlngLat: `${marker.extData.latitude},${marker.extData.longitude}` || '',\r\n\t\t\t\t\tupdateTime: marker.extData.updateTime || '',\r\n\t\t\t\t\tlocationTime: marker.extData.locationTime || '',\r\n\t\t\t\t\tspeed: marker.extData.speed || '',\r\n\t\t\t\t\ttotalMileage: marker.extData.totalMileage || '',\r\n\t\t\t\t\taddress: marker.extData.address || ''\r\n\t\t\t\t}\r\n\t\t\t\tshowDevicePopup.value = true\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tuni.__f__('warn','at pages/index/index.uvue:167','无法获取标记点信息', e)\r\n\t\tuni.showToast({\r\n\t\t\ttitle: '无法获取设备信息',\r\n\t\t\ticon: 'none'\r\n\t\t})\r\n\t}\r\n\r\n\t// 关闭弹窗\r\n\tconst closeDevicePopup = () => {\r\n\t\tshowDevicePopup.value = false\r\n\t}\r\n\r\n\t// 切换地图/列表视图\r\n\tconst toggleMapMode = () => {\r\n\t\tshowMap.value = !showMap.value\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t.container {\r\n\t\tposition: relative;\r\n\t\twidth: 100%;\r\n\t\theight: 100vh;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tbackground-color: #f5f7fa;\r\n\r\n\t\t.map-container {\r\n\t\t\tflex: 1;\r\n\t\t\twidth: 100%;\r\n\t\t\tposition: relative;\r\n\t\t}\r\n\r\n\t\t.tool-nav {\r\n\t\t\tposition: absolute;\r\n\t\t\ttop: 200rpx;\r\n\t\t\tright: 20rpx;\r\n\t\t\tz-index: 100;\r\n\r\n\t\t\t.btn-map-list {\r\n\t\t\t\twidth: 60rpx;\r\n\t\t\t\theight: 60rpx;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t.btn-map-list-icon {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tpadding: 8rpx;\r\n\t\t\t\tborder-radius: 10rpx;\r\n\t\t\t\tbackground-color: #69c2f1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>","import MiniProgramPage from '/Users/xyhc/Documents/carConnectInternet/pages/index/index.uvue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","reactive","onMounted","__awaiter","amapFile","MiniProgramPage"],"mappings":"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"}