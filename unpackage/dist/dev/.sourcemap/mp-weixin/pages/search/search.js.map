{"version":3,"file":"search.js","sources":["pages/search/search.uvue","pages/search/search.uvue?type=page"],"sourcesContent":["<template>\n  <view class=\"search-page\">\n    <view class=\"search-header\">\n      <view class=\"search-box\">\n        <uni-icons type=\"arrowleft\" size=\"20\" @tap=\"goBack\" />\n        <input \n          class=\"search-input\" \n          placeholder=\"搜索地点\" \n          v-model=\"keyword\"\n          @input=\"onInput\"\n          focus\n        />\n        <view class=\"clear-btn\" v-if=\"keyword\" @tap=\"clearKeyword\">\n          <uni-icons type=\"clear\" size=\"20\" />\n        </view>\n      </view>\n    </view>\n    \n    <scroll-view class=\"search-result\" scroll-y>\n      <view \n        class=\"result-item\" \n        v-for=\"(item, index) in searchResults\" \n        :key=\"index\"\n        @tap=\"selectLocation(item)\"\n      >\n        <view class=\"item-name\">{{ item.name }}</view>\n        <view class=\"item-address\">{{ item.address }}</view>\n      </view>\n      \n      <view class=\"no-result\" v-if=\"keyword && searchResults.length === 0\">\n        未找到相关地点\n      </view>\n      \n      <view class=\"hot-search\" v-if=\"!keyword\">\n        <view class=\"section-title\">热门搜索</view>\n        <view class=\"hot-tags\">\n          <view \n            class=\"hot-tag\" \n            v-for=\"(tag, index) in hotTags\" \n            :key=\"'tag'+index\"\n            @tap=\"searchTag(tag)\"\n          >\n            {{ tag }}\n          </view>\n        </view>\n        \n        <view class=\"section-title\">搜索历史</view>\n        <view \n          class=\"history-item\" \n          v-for=\"(item, index) in searchHistory\" \n          :key=\"'his'+index\"\n          @tap=\"selectLocation(item)\"\n        >\n          <uni-icons type=\"time\" size=\"16\" color=\"#999\" />\n          <view class=\"history-text\">{{ item.name }}</view>\n        </view>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script lang=\"uts\">\nimport { ref, onMounted } from 'vue';\n\nexport default {\n  setup() {\n    const keyword = ref('');\n    const searchResults = ref([]);\n    const hotTags = ref(['餐厅', '酒店', '超市', '医院', '银行', '学校', '加油站', '停车场']);\n    const searchHistory = ref([]);\n    const lat = ref(0);\n    const lng = ref(0);\n    const debounceTimer = ref(null);\n\n    onMounted(() => {\n      const pages = getCurrentPages();\n      const currentPage = pages[pages.length - 1];\n      const options = currentPage.options;\n      \n      lat.value = parseFloat(options.lat) || 39.9042;\n      lng.value = parseFloat(options.lng) || 116.4074;\n      loadSearchHistory();\n    });\n\n    const loadSearchHistory = () => {\n      const history = uni.getStorageSync('mapSearchHistory') || [];\n      searchHistory.value = history;\n    };\n\n    const onInput = () => {\n      clearTimeout(debounceTimer.value);\n      debounceTimer.value = setTimeout(() => {\n        if (keyword.value.trim()) {\n          searchPOI(keyword.value);\n        } else {\n          searchResults.value = [];\n        }\n      }, 300);\n    };\n\n    const searchPOI = (keyword) => {\n      // 实际项目中应调用地图API或后端接口\n      searchResults.value = [\n        {\n          id: '1',\n          name: `${keyword}测试地点1`,\n          address: '北京市海淀区测试地址1',\n          latitude: lat.value + (Math.random() * 0.01 - 0.005),\n          longitude: lng.value + (Math.random() * 0.01 - 0.005)\n        },\n        {\n          id: '2',\n          name: `${keyword}测试地点2`,\n          address: '北京市海淀区测试地址2',\n          latitude: lat.value + (Math.random() * 0.01 - 0.005),\n          longitude: lng.value + (Math.random() * 0.01 - 0.005)\n        }\n      ] as any;\n    };\n\n    const searchTag = (tag) => {\n      keyword.value = tag;\n      searchPOI(tag);\n    };\n\n    const selectLocation = (item) => {\n      const history = uni.getStorageSync('mapSearchHistory') || [];\n      const index = history.findIndex(h => h.id === item.id);\n      if (index >= 0) {\n        history.splice(index, 1);\n      }\n      history.unshift(item);\n      if (history.length > 10) {\n        history.pop();\n      }\n      uni.setStorageSync('mapSearchHistory', history);\n      \n      uni.navigateBack({\n        delta: 1,\n        success: () => {\n          const eventChannel = getOpenerEventChannel();\n          eventChannel.emit('selectLocation', item);\n        }\n      });\n    };\n\n    const clearKeyword = () => {\n      keyword.value = '';\n      searchResults.value = [];\n    };\n\n    const goBack = () => {\n      uni.navigateBack();\n    };\n\n    return {\n      keyword,\n      searchResults,\n      hotTags,\n      searchHistory,\n      onInput,\n      searchTag,\n      selectLocation,\n      clearKeyword,\n      goBack\n    };\n  }\n};\n</script>\n\n<style>\n.search-page {\n  width: 100%;\n  height: 100vh;\n  background-color: #f5f5f5;\n}\n\n.search-header {\n  padding: 15px;\n  background-color: #fff;\n}\n\n.search-box {\n  display: flex;\n  align-items: center;\n  background-color: #f5f5f5;\n  border-radius: 20px;\n  padding: 8px 15px;\n}\n\n.search-input {\n  flex: 1;\n  height: 30px;\n  margin: 0 10px;\n  font-size: 14px;\n}\n\n.clear-btn {\n  width: 20px;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.search-result {\n  height: calc(100vh - 60px);\n  padding: 15px;\n}\n\n.result-item {\n  padding: 12px 0;\n  border-bottom: 1px solid #eee;\n}\n\n.item-name {\n  font-size: 16px;\n  margin-bottom: 4px;\n}\n\n.item-address {\n  font-size: 12px;\n  color: #999;\n}\n\n.no-result {\n  padding: 20px;\n  text-align: center;\n  color: #999;\n}\n\n.section-title {\n  font-size: 14px;\n  color: #999;\n  margin: 15px 0 10px;\n}\n\n.hot-tags {\n  display: flex;\n  flex-wrap: wrap;\n}\n\n.hot-tag {\n  padding: 6px 12px;\n  background-color: #fff;\n  border-radius: 15px;\n  margin-right: 10px;\n  margin-bottom: 10px;\n  font-size: 14px;\n}\n\n.history-item {\n  display: flex;\n  align-items: center;\n  padding: 12px 0;\n  border-bottom: 1px solid #eee;\n}\n\n.history-text {\n  margin-left: 8px;\n  font-size: 14px;\n}\n</style>","import MiniProgramPage from '/Users/xyhc/Documents/carConnectInternet/pages/search/search.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","ref","onMounted","uni","keyword"],"mappings":"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"}